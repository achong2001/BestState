# Results

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyr)
library(GGally)
library(dplyr)
library(ggplot2)
library(vcd)
library(ggridges) 
library(redav)
```


```{r}
states <- read.csv("States.csv")
```

```{r}
# Create a data frame with state and region columns

state_region_mapping <- data.frame(
  state = c("Connecticut", "Maine", "Massachusetts", "New Hampshire", "Rhode Island", "Vermont",
            "New Jersey", "New York", "Pennsylvania",
            "Illinois", "Indiana", "Michigan", "Ohio", "Wisconsin",
            "Iowa", "Kansas", "Minnesota", "Missouri", "Nebraska", "North Dakota", "South Dakota",
            "Delaware", "Florida", "Georgia", "Maryland", "North Carolina", "South Carolina", "Virginia",
            "District of Columbia", "West Virginia", "Alabama", "Kentucky", "Mississippi", "Tennessee",
            "Arkansas", "Louisiana", "Oklahoma", "Texas", "Arizona",
            "Colorado", "Idaho", "Montana", "Nevada","New Mexico", 
            "Utah", "Wyoming", "Alaska", "California", "Hawaii", "Oregon", "Washington"),
  
  region = c("Northeast", "Northeast", "Northeast", "Northeast", "Northeast", "Northeast",
             "Northeast", "Northeast", "Northeast",
             "Midwest", "Midwest", "Midwest", "Midwest", "Midwest",
             "Midwest", "Midwest", "Midwest", "Midwest", "Midwest", "Midwest", "Midwest",
             "South", "South", "South", "South", "South", "South", "South",
             "South", "South", "South", "South", "South", "South", "South",
             "South", "South", "South", "South",
             "West", "West", "West", "West", "West",
             "West", "West", "West", "West", "West", "West","West")
)

merged_data <- merge(states, state_region_mapping, by.x = "STATES", by.y = "state")

# Create a named vector for mapping
state_to_region <- setNames(state_region_mapping$region, state_region_mapping$state)

states$REGION <- state_to_region[states$STATES]
```


```{r}
#Reformatting the dataset 
states$INCOME <- gsub(",", "", states$INCOME)
states$INCOME <- as.numeric(states$INCOME)

states$POPULATION <- gsub(",", "", states$POPULATION)
states$POPULATION <- as.numeric(states$POPULATION)

states$U18 <- gsub(",", "", states$U18)
states$U18 <- as.numeric(states$U18)

states$OVER60 <- gsub(",", "", states$OVER60)
states$OVER60 <- as.numeric(states$OVER60)

states$REGION <- as.character(states$REGION)
```


```{r}
#Graph1: Demographic Overview Across the States
ggplot(states, aes(x=reorder(STATES,desc(POPULATION/1000)),y=POPULATION/1000))+
  geom_col(fill = "lightblue")+
  facet_wrap(~REGION, scales = "free")+
  labs(x ="State", y="Population",title = "Distribution of Population across U.S by Region (Unit:1,000)")+ 
  theme(axis.text.y = element_text(size = 6))+
  theme(axis.text.x = element_text(size = 6, angle = 30, vjust = 0.5, hjust = 1))
```
>This is an overview of population distribution across different regions of the United States, with each subgraph representing one of the four major regions: Midwest, Northeast, South, and West. The y-axis of each graph shows the population in thousands.
> We can see that the South and West regions show states with very high populations, suggesting these regions have certain attractions, possibly including warmer climates, growing economies, or industry presence such technology.There are also some states have significantly higher populations than others within the same region, which can be considered as an indication for of active economic environment or desirable living conditions. For example, California in the West and Texas and Florida in the South ranking the first within their regions, with the population of close to 40,000 thousands and over 20,000 thousands.
>States with fewer people living in them often depend more on farming or using things from nature, like minerals and forests, for their money. They usually don't have big cities, and some can be hard to get to because of where they are on the map, like Alaska and Wyoming. This can also suit to the preference of certain group of population when consider moving around the states. 

```{r}
#Graph2: Demographic Overview Across the States2

# Reshape the data from wide to long
states_long <- states %>%
  pivot_longer(cols = c(U18, OVER60), names_to = "Age_Group", values_to = "Population")

# Plot the data
ggplot(states_long, aes(x = reorder(STATES,Population), y = Population/1000, fill = Age_Group)) +
  geom_col(position = "dodge", width = 0.8) +
  labs(title = "Teenage and Senior Distribution across U.S By Region (Unit:1,000)",
       y = "Population",
       x = "States",
       fill = "Age_Group") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 6)) +
  coord_flip()+
  facet_wrap(~ REGION, scales = "free_y")
```
>The above set of bar graphs represent the distribution of two age groups, teenagers (people with age under 18, shown in blue) and seniors (people with age over 60, shown in red), across U.S. states within four regions, in the unit of thousands. In general, a larger proportion of teenagers suggests a large potential in robust population growth, the work force growth, abundant educational and job opporunities. Whereas a larger proportion of seniors suggest that these places might be popular for retirement, and they may have a bigger need for healthcare services and retirement homes. The balance between two groups is also very important, in terms of whether the population pyramid is stable so that the challenges of supporting the seniors wound't arise.
>From the graph, we can identify a genereal trend of relative prominance in the senior population,for which is more notable in the northeast region, indicating a preferable environment for elders and for possible historical reasons. The states with most substaintial teenage population is texas, and states with the most substaintial senior population is florida. The high in teenage population might be due to higher birth rates, migration of younger families, or both. The significant number of seniors in Florida is consistent with its reputation as a retirement destination due to its warm climate and tax-friendly policies for retirees.
>In the Midwest region, the states has a relatively balanced the populations of teenagers and seniors, suggesting a stable demographic.This can be a result from lacking of both incoming and outgoing population due to family-oriented cultrual tradition in Midwest.This can be considered somewhat less prefereable enviornment for movers in terms of lack of fluidty and diversity in population and hence social classes, but the stability can be good for those who wants to settle down in a place for long term.


```{r}
#Graph3: Income Distribution By Region

ggplot(states, aes(x = INCOME, y = REGION)) +
  geom_boxplot(varwidth = TRUE) +
  geom_density_ridges(aes(fill = REGION), scale = 0.9, alpha = 0.6) +
  labs(title = "Distribution of Annual Personal Income by Region(USD)")
```

>This graph is a overview of Annual personal income distribution by region. The personal income is considered as a straight forward indication for the economic well-being and financial prosperity of the local communities. From the boxplot, we can see that the northeast region has the highest 75% percentile, median, and 25% percential among all the regions, where the south region has the lowest for all.
>The West and Norteast region tends to have larger spread than the South and Midwest Region, this can be consider as a higher divide in income inequality, but also an indication for the dynamic in different opporunties. This is consistent with our common knwoledge, where the west is considered to be a tech hub and the northeast is considered to be the financial hub. These are the two highest paying industry in the U.S and such that result in a higher annual personal income in these region, which means more job opportuinies and a better career development path.
>The smallest variability of income in the Midwest region correspond to the high stability in the population structure as suggested in the graph 2, which means a rather  

```{r}
#Graph4: Income Distribution By Region

ggplot(states, aes(x=reorder(STATES,desc(INCOME)),y=INCOME))+
  geom_col(fill = "lightblue")+
  facet_wrap(~REGION, scales = "free")+
  labs(x ="State", y="Income(USD)",title = "Distribution of Annual Personal Income Per Capita across U.S by Region")+
  theme(axis.text.y = element_text(size = 6))+
  theme(axis.text.x = element_text(size = 6, angle = 30, vjust = 0.5, hjust = 1))
```



```{r}
#Graph4: GINI Index across states

ggplot(states, aes(x = GINI, y = reorder(STATES, GINI))) +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.5, binwidth = 0.2) +
  facet_wrap(~REGION, scales = "free_y", ncol = 1, labeller = labeller(REGION = label_wrap_gen(15)), strip.position = "right") +
  geom_point(color = "blue")+
  ggtitle("GINI Index Across States by Region") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 5))
```

>COMMENTARY4

```{r}

#Reformat the columns
states$HSGRADUATE <- gsub(",", "", states$HSGRADUATE)
states$HSGRADUATE <- as.numeric(states$HSGRADUATE)

states$EMPLOYMENT <- gsub(",", "", states$EMPLOYMENT)
states$EMPLOYMENT <- as.numeric(states$EMPLOYMENT)

states$POVERTY <- gsub("%", "", states$POVERTY)
states$POVERTY <- as.numeric(states$POVERTY)

#Convert to percentage
states$U18_rate <- (states$U18) / (states$POPULATION)
states$OVER60_rate <- (states$OVER60) / (states$POPULATION)
states$HSGRADUATE_rate <- (states$HSGRADUATE) / (states$POPULATION)
states$EMPLOYMENT_rate <- (states$EMPLOYMENT) / (states$POPULATION)
```


```{r}
#New Data Frame

states_new <-states[, c("STATES", "GINI", "OBESE","POVERTY","CRIME","INCOME","MENTAL","INFM","U18_rate","OVER60_rate","HSGRADUATE_rate","EMPLOYMENT_rate","REGION")]
```

```{r}
#Convert to Percentage
states_new$OBESE <- (states_new$OBESE) / 100
states_new$POVERTY <- states_new$POVERTY/ 100
states_new$INFM <- states_new$INFM/ 100
```

```{r}

#Rescale Crime and Mental from 0 to 1 by min-max scaling 
min_value <- min(states_new$CRIME)
max_value <- max(states_new$CRIME)
states_new$CRIME<- (states_new$CRIME - min_value) / (max_value - min_value)

min_value <- min(states_new$MENTAL)
max_value <- max(states_new$MENTAL)
states_new$MENTAL <- (states_new$MENTAL - min_value) / (max_value - min_value)

```

```{r}
#Create Levels for Obese, Crime, Poverty, mental based on their quantiles 
#VLOW: below min; LOW: Q1-Median, MOD:Median - Q3, HIGH: Q3-MAX

states_new$OBESE_levels <- cut(states_new$OBESE,
                   breaks=c(-Inf, quantile(states_new$OBESE, 0.25), median(states_new$OBESE), quantile(states_new$OBESE, 0.75), Inf),
                   labels=c('VLOW', 'LOW', 'MOD', 'HIGH'))

states_new$CRIME_levels <- cut(states_new$CRIME,
                   breaks=c(-Inf, quantile(states_new$CRIME, 0.25), median(states_new$CRIME), quantile(states_new$CRIME, 0.75), Inf),
                   labels=c('VLOW', 'LOW', 'MOD', 'HIGH'))

states_new$POVERTY_levels <- cut(states_new$POVERTY,
                   breaks=c(-Inf, quantile(states_new$POVERTY, 0.25), median(states_new$POVERTY), quantile(states_new$POVERTY, 0.75), Inf),
                   labels=c('VLOW', 'LOW', 'MOD', 'HIGH'))

states_new$MENTAL_levels <- cut(states_new$MENTAL,
                   breaks=c(-Inf, quantile(states_new$MENTAL, 0.25), median(states_new$MENTAL), quantile(states_new$MENTAL, 0.75), Inf),
                   labels=c('VLOW', 'LOW', 'MOD', 'HIGH'))
```


```{r}
#Graph5: Obese v.s Poverty rate by region
mosaic(POVERTY_levels~REGION+OBESE_levels, data = states_new,
direction = c("h", "v","h"),
rot_labels = c(0, 0),
highlighting_fill=c('#87CEEB', '#C85A89', '#D2691E', "#FFD700"))
```
>COMMENTARY5

```{r}
#Graph6: Mental v.s Crime by region
mosaic(CRIME_levels~REGION+MENTAL_levels, data = states_new,
direction = c("h", "v","h"),
rot_labels = c(0, 0),
highlighting_fill=c('#87CEEB', '#C85A89', '#D2691E', "#FFD700"))
```
>COMMENTARY6

```{r}
#Graph7: Biplot for all features

draw_biplot(states_new)+ 
  ggplot2::ggtitle("Biplot of states on different features")
```
>COMMENTARY7

```{r}
#Graph8: Scatterplot Matrix between the important features

ggpairs(states_new[,c("GINI", "OBESE","POVERTY","CRIME","INCOME","MENTAL","INFM","HSGRADUATE_rate","EMPLOYMENT_rate")])
```
>COMMENTARY8

```{r}
#Graph9: Biplot for young couples

states_1 <- states_new[,c("STATES","MENTAL","GINI","INCOME","EMPLOYMENT_rate")]
draw_biplot(states_1)+ 
  ggplot2::ggtitle("Biplot for young couples")
```
>COMMENTARY9

```{r}
#Graph10: Biplot for families 

states_2 <- states_new[,c("STATES","INFM","U18_rate","HSGRADUATE_rate")]
draw_biplot(states_2)+ 
  ggplot2::ggtitle("Biplot for families ")
```
>COMMENTARY10





